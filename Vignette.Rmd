---
title: "Functional Autoregression for Cumulative Distribution Fucntions"
author: "Hantao"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


## Introduction

This package fit the FAR model and its monotone modified version (called FARPAVA) to functional time series data generated by cumulative functions. It also contains functions considered as middle steps, including vector auto-regression, isotonic regression and monotone cubic hermite interpolation. It also contains the simulation scanrio I proposed in my report. 

## Installing the `MonoFar` package
You may download the package by using the following command.
```{r setup2}
devtools::install_github("hantao-wu/FarPava")
```

The following packages were used for the analysis. 
```{r other packages, message=FALSE, warning = FALSE}
library(ggplot2)
library(vars)
library(MonoFar)
```

## Example - Simulation 1

Generate Data: This shows an example using function 'Sim_data' to generate observed data set and evaluating data set for future use. Split the observed data set into train and test data sets (split by time order) to train the model
```{r, data}
#simulation parameters
t=200
locations = seq(from = -10, to = 10, by = 2)
test_locations = c(-7.5,0.5,7.5)
sigma_noise = 0.05
sigma_error = 0
change_speed = 0.235

#for reproducable
set.seed(2012)

#generate data sets
simulation <- Sim_data(t,locations,test_locations,sigma_noise,sigma_error,change_speed)
data.sim <- simulation$data
test_offgrid.sim <- simulation$test

colnames(data.sim) = c("-10","-8","-6","-4","-2","0"
                       ,"2","4","6","8","10")
colnames(test_offgrid.sim) = c("-7.5","0.5","7.5")

data.sim <- data.sim[t:1,]

train.sim <- data.sim[1:(t-10),]
test.sim  <- data.sim[(t-9):(t-5),]

```

```{r, simplot, warning=FALSE}
#train
ggplot() +  
  geom_line(mapping=aes(y=train.sim[1,],x=locations,color='early')) +
  geom_line(mapping=aes(y=train.sim[2,],x=locations,color='early')) +
  geom_line(mapping=aes(y=train.sim[3,],x=locations,color='early')) +
  geom_line(mapping=aes(y=train.sim[4,],x=locations,color='early')) +
  geom_line(mapping=aes(y=train.sim[5,],x=locations,color='early')) +
  geom_line(mapping=aes(y=train.sim[153,],x=locations,color='mid')) +
  geom_line(mapping=aes(y=train.sim[154,],x=locations,color='mid')) +
  geom_line(mapping=aes(y=train.sim[155,],x=locations,color='mid')) +
  geom_line(mapping=aes(y=train.sim[156,],x=locations,color='mid')) +
  geom_line(mapping=aes(y=train.sim[157,],x=locations,color='mid')) +
  geom_line(mapping=aes(y=train.sim[186,],x=locations,,color='late')) +
  geom_line(mapping=aes(y=train.sim[187,],x=locations,,color='late')) +
  geom_line(mapping=aes(y=train.sim[188,],x=locations,,color='late')) +
  geom_line(mapping=aes(y=train.sim[189,],x=locations,,color='late')) +
  geom_line(mapping=aes(y=train.sim[190,],x=locations,,color='late')) +
  scale_color_manual(values = c('early'=1, 'mid' = 2, 'late'=3)) +
  xlab("location") + ylab("Probability") + ylim(0,1)+
  ggtitle("Selected Train CDFs Over Time") 
#test
ggplot() +  
  geom_line(mapping=aes(y=test.sim[5,],x=locations,color='t=194')) +
  geom_line(mapping=aes(y=test.sim[4,],x=locations,color='t=193')) +
  geom_line(mapping=aes(y=test.sim[3,],x=locations,color='t=192')) +
  geom_line(mapping=aes(y=test.sim[2,],x=locations,color='t=191')) +
  geom_line(mapping=aes(y=test.sim[1,],x=locations,color='t=190')) +
  scale_color_manual(values = c('t=190'=1, 't=191' = 2, 't=192'=3, 't=193'=4, 't=194'=5)) +
  xlab("location") + ylab("Probability") + ylim(0,1)+
  ggtitle("Test CDFs Over Time") 
```

Fit both FAR and FARPAVA model:
```{r, far, warning=FALSE}
VAR_est <- vars::VAR(y = train.sim, p = 1) #var(1), used for plot later

forecast.sim <- Fun_Pred(locations, train.sim, locations, p=1, ahead=5, ci=0.95)
forecast.sim_pava <- Fun_cdf_Pred(locations, train.sim, locations, p=1, ahead=5, ci=0.95)
```

```{r, farplot, warning=FALSE}
ggplot() +  
  geom_line(mapping=aes(y=forecast.sim[5,],x=locations,color='t=194')) +
  geom_point(mapping=aes(y=forecast.sim[5,],x=locations,color='t=194')) +
  geom_line(mapping=aes(y=forecast.sim[4,],x=locations,color='t=193')) +
  geom_point(mapping=aes(y=forecast.sim[4,],x=locations,color='t=193')) +
  geom_line(mapping=aes(y=forecast.sim[3,],x=locations,color='t=192')) +
  geom_point(mapping=aes(y=forecast.sim[3,],x=locations,color='t=192'))+
  geom_line(mapping=aes(y=forecast.sim[2,],x=locations,color='t=191')) +
  geom_point(mapping=aes(y=forecast.sim[2,],x=locations,color='t=191')) +
  geom_line(mapping=aes(y=forecast.sim[1,],x=locations,color='t=190')) +
  geom_point(mapping=aes(y=forecast.sim[1,],x=locations,color='t=190')) +
  scale_color_manual(values = c('t=190'=1, 't=191' = 2, 't=192'=3, 't=193'=4, 't=194'=5)) +
  xlab("location") + ylab("Probability") +
  ggtitle("Non-modified Forecast CDFs Over Time") 
ggplot() +  
  geom_line(mapping=aes(y=forecast.sim_pava[5,],x=locations,color='t=194')) +
  geom_point(mapping=aes(y=forecast.sim_pava[5,],x=locations,color='t=194')) +
  geom_line(mapping=aes(y=forecast.sim_pava[4,],x=locations,color='t=193')) +
  geom_point(mapping=aes(y=forecast.sim_pava[4,],x=locations,color='t=193')) +
  geom_line(mapping=aes(y=forecast.sim_pava[3,],x=locations,color='t=192')) +
  geom_point(mapping=aes(y=forecast.sim_pava[3,],x=locations,color='t=192')) +
  geom_line(mapping=aes(y=forecast.sim_pava[2,],x=locations,color='t=191')) +
  geom_point(mapping=aes(y=forecast.sim_pava[2,],x=locations,color='t=191')) +
  geom_line(mapping=aes(y=forecast.sim_pava[1,],x=locations,color='t=190')) +
  geom_point(mapping=aes(y=forecast.sim_pava[1,],x=locations,color='t=190')) +
  scale_color_manual(values = c('t=190'=1, 't=191' = 2, 't=192'=3, 't=193'=4, 't=194'=5)) +
  xlab("location") + ylab("Probability") + ylim(0,1) +
  ggtitle("modified Forecast CDFs Over Time") 
```



